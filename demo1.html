<!DOCTYPE html>
<html>
    <head>
        <title>noVNC Demo</title>

        <!-- TODO: Update to use the noVNC/ submodule instead, once it's updated -->
        <link rel="icon" sizes="any" type="image/svg+xml" href="noVNC-latest/app/images/icons/novnc-icon.svg" />
        <!-- Repeated last so that legacy handling will pick this -->
        <link rel="icon" sizes="16x16" type="image/png" href="noVNC-latest/app/images/icons/novnc-16x16.png" />
    </head>
    <body>

        <div style="width: 600">
            This is a realtime playback of a previously recorded VNC
            session. The RFB/VNC data is encoded into a Javascript
            file which is loaded with the page. This demo excercises
            noVNC's decoding and rendering logic, but stubs out the
            keyboard/mouse input and the WebSockets network
            connection.
            <strong>The red and blue channels are reversed because
                this capture was taken prior to a change in the way
                noVNC initializes with the server.</strong>
        </div>

        <br><br>

        <input id='startButton' type='button' value='Start' style='width:100px'
            onclick="startit();" disabled>&nbsp;

        <div id="VNC_screen">
            <div id="VNC_status_bar" class="VNC_status_bar" style="margin-top: 0px;">
                <table border=0 width=100%><tr>
                    <td><div id="VNC_status">Loading</div></td>
                </tr></table>
            </div>
            <canvas id="VNC_canvas" width="640px" height="20px">
                Canvas not supported.
            </canvas>
        </div>

    </body>

    <!--
    <script type='text/javascript' 
        src='http://getfirebug.com/releases/lite/1.2/firebug-lite-compressed.js'></script>
    -->

    <script>
        INCLUDE_URI = "noVNC/include/";
    </script>
    <script src="noVNC/include/vnc.js"></script>
    <script src="noVNC/include/playback.js"></script>
    <script src="data/demo1.js"></script>

    <script>
        var start_time;

        updateState = function (rfb, state, oldstate, msg) {
            switch (state) {
                case 'failed':
                case 'fatal':
                    Util.Error("noVNC sent '" + state + "' state during iteration " + iteration);
                    test_state = 'failed';
                    break;
                case 'loaded':
                    $D('startButton').disabled = false;
                    break;
            }
            if (typeof msg !== 'undefined') {
                $D('VNC_status').innerHTML = msg;
            }
        }

        function startit() {
            $D('startButton').value = "Running";
            $D('startButton').disabled = true;

            iterations = 1;
            iteration = 0;
            start_time = (new Date()).getTime();

            next_iteration();
        }

        function finish() {
            // Finished with all iterations
            var total_time, end_time = (new Date()).getTime();
            total_time = end_time - start_time;

            iter_time = parseInt(total_time / iterations, 10);
            Util.Info(iterations + " iterations took " + total_time + "ms, " +
                    iter_time + "ms per iteration");
            // Shut-off event interception
            rfb.get_mouse().ungrab();
            rfb.get_keyboard().ungrab();
            $D('startButton').disabled = false;
            $D('startButton').value = "Start";
            $D('VNC_status').innerHTML = "Done";
        }

        window.onload = function() {
            mode = 'realtime';
            Util.Info("VNC_frame_data.length: " + VNC_frame_data.length);
            rfb = RFB({'target': $D('VNC_canvas'),
                       'updateState': updateState});
            rfb.testMode(send_array);
        }
    </script>
</html>
